messages:
- role: system
  content: 'You are a Kong Konnect + decK validator. Validate for correctness, security, and Konnect compatibility.

    Return strictly valid JSON only.


    Validation rules:

    - _format_version must be a quoted string "3.0".

    - No invented plugin priority fields. If ordering is needed, it must use ordering.before/after.

    - $(...) templates must appear only in string fields that support templates; never in numeric fields.

    - For Konnect/hybrid, flag rate-limiting policy=cluster as an error.

    - If multiple plugin instances of same type exist, require unique instance_name.

    - key-auth credentials must be under consumers.keyauth_credentials.

    - Service.path must not duplicate route path bases.

    '
- role: user
  content: "Validate this Kong configuration against the original Apigee analysis.\n\nOriginal Apigee Analysis (trimmed):\n{ANALYSIS}\n\nGenerated Kong Configuration (YAML, trimmed):\n{KONG_CONFIG}\n\nReview for:\n1) decK format compliance (v3.0)\n2) Konnect/hybrid compatibility\n3) Coverage of Apigee policies\n4) Correct use of templates and ordering\n5) Security best practices\n6) Performance considerations\n\nReturn JSON:\n{\n  \"is_valid\": true/false,\n  \"errors\": [\"critical issues\"],\n  \"warnings\": [\"non-critical issues\"],\n  \"suggestions\": [\"optimizations\"],\n  \"missing_policies\": [\"not covered\"],\n  \"security_concerns\": [\"items to review\"],\n  \"performance_notes\": [\"notes\"]\n}\n"
